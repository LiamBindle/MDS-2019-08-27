<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>reveal.js</title>

		<link rel="stylesheet" href="css/reset.css">
		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/simple.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/github-gist.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<h2 style="margin: 0; text-align: left;">CMake (the dev side)</h2>
					<hr>
					<h4 style="margin: 0;">MDS</h4>
					<h4 style="margin: 0;">2019-08-27</h4>
					<h4 style="margin: 0;">Liam Bindle</h4>
				</section>
				<section>
					<div style="text-align: left;">
						<h3 style="margin: 0;">Overview</h3>
						<hr>
						<ul>
							<li>A Basic CMake Project</li>
							<li>Targets and properties</li>
							<li>A Bigger CMake Project</li>
							<li>The Results</li>
						</ul>
					</div>
				</section>
				<section>
					<h2>A Basic CMake Project</h2>
				</section>
				<!-- Slide 1 -->
				<section>
					<section>
						<h3 style="margin: 0;">A Basic CMake Project</h3>
						<h5 style="margin: 0">Overview</h5>
						<hr style="margin-bottom: 20px">
						<div class="container" style="width: 80%">
							<div class="inline-wide" style="text-align: left; margin-right: 100px;">
								<ul>
									<li>Example of a simple CMake project</li>
									<li>Its an F90 module that wraps the original bhmie code
										<ul>
											<li>Original bhmie code: <a href="http://scatterlib.wikidot.com/mie">scatterlib/bhmie</a></li>
											<li><code>bhmie_mod.f90 </code> is the module</li>
											<li><code>bhmie_smod.f </code> is the original bhmie code as a submodule</li>
											<li><code>callbhmie.f </code> is the example program</li>
										</ul>
									</li>
								</ul>
							</div>
							<div class="file-tree" style="margin: 0;"> 
								<h3>Directory structure</h3>
								<code>bhmie-f/<br>
								├── bhmie_mod.f90<br>
								├── bhmie_smod.f<br>
								├── callbhmie.f<br>
								├── CMakeLists.txt<br>
								└── README<br></code>
							</div>
						</div>
					</section>
				</section>

				<!-- Slide 1 -->
				<section>
					<h3 style="margin: 0;">A Basic CMake Project</h3>
					<h5 style="margin: 0">Conceptually we need to...</h5>
					<hr style="margin-bottom: 40px">
					<div class="container" style="width: 80%">
						<div class="inline-wide" style="text-align: left; margin-right: 80px;">
							<ol>
								<li>Build a static library called <code>libbhmie.a</code> from
									<ul>
										<li><code>bhmie_mod.f90</code></li>
										<li><code>bhmie_smod.f</code></li>
									</ul>
								</li>
								<li>Build an executable from "callbhmie.f"
									<ul><li>Link <code>libbhmie.a</code></li></ul>
								</li>
							</ol>
						</div>
						<div class="file-tree" style="margin: 0;"> 
							<h3>Directory structure</h3>
							<code>bhmie-f/<br>
								├── bhmie_mod.f90<br>
								├── bhmie_smod.f<br>
								├── callbhmie.f<br>
								├── CMakeLists.txt<br>
								└── README<br></code>
						</div>
					</div>
				</section>

				<!-- Slide 1 -->
				<section data-transition="none-out">
					<h3 style="margin: 0;">A Basic CMake Project</h3>
					<h5 style="margin: 0">bhmie-f/CMakeLists.txt</h5>
					<hr>
					<div class="container">
						<div class="file-tree"> 
							<code><strong>bhmie-f/</strong><br>
								├── bhmie_mod.f90<br>
								├── bhmie_smod.f<br>
								├── callbhmie.f<br>
								├── <strong>CMakeLists.txt</strong><br>
								└── README<br>
							</code>
						</div>
						<div class="inline-wide"><pre><code class="cmake" data-trim data-noescape data-line-numbers>
							cmake_minimum_required(VERSION 3.5)
							project(bhmie VERSION 1.0.0 LANGUAGES Fortran)


							# Add a static library called libbhmie.a
							add_library(bhmie STATIC
								bhmie_smod.f
								bhmie_mod.f90
							)


							# Add an executable called callbhmie
							add_executable(callbhmie
								callbhmie.f
							)
							# Specify that callbhmie links to libbhmie.a
							target_link_libraries(callbhmie
								bhmie 
							)
						</code></pre></div>
					</div>
				</section>

				<section data-transition="none-in none-out">
					<h3 style="margin: 0;">A Basic CMake Project</h3>
					<h5 style="margin: 0">bhmie-f/CMakeLists.txt</h5>
					<hr>
					<div class="container">
						<div class="file-tree"> 
							<code><strong>bhmie-f/</strong><br>
								├── bhmie_mod.f90<br>
								├── bhmie_smod.f<br>
								├── callbhmie.f<br>
								├── <strong>CMakeLists.txt</strong><br>
								└── README<br>
							</code>
						</div>
						<div class="inline-wide"><pre><code class="cmake" data-trim data-noescape data-line-numbers="1-2">
							cmake_minimum_required(VERSION 3.5)
							project(bhmie VERSION 1.0.0 LANGUAGES Fortran)


							# Add a static library called libbhmie.a
							add_library(bhmie STATIC
								bhmie_smod.f
								bhmie_mod.f90
							)


							# Add an executable called callbhmie
							add_executable(callbhmie
								callbhmie.f
							)
							# Specify that callbhmie links to libbhmie.a
							target_link_libraries(callbhmie
								bhmie 
							)
						</code></pre></div>
					</div>
				</section>

				<!-- Slide 2 -->
				<section data-transition="none-in none-out">
					<section>
						<h3 style="margin: 0;">A Basic CMake Project</h3>
						<h5 style="margin: 0">bhmie-f/CMakeLists.txt</h5>
						<hr>
						<div class="container">
								<div class="file-tree"> 
									<code><strong>bhmie-f/</strong><br>
										├── bhmie_mod.f90<br>
										├── bhmie_smod.f<br>
										├── callbhmie.f<br>
										├── <strong>CMakeLists.txt</strong><br>
										└── README<br>
									</code>
								</div>
								<div class="inline-wide"><pre><code class="cmake" data-trim data-noescape data-line-numbers="5-9">
									cmake_minimum_required(VERSION 3.5)
									project(bhmie VERSION 1.0.0 LANGUAGES Fortran)
		
		
									# Add a static library called libbhmie.a
									add_library(bhmie STATIC
										bhmie_smod.f
										bhmie_mod.f90
									)
		
		
									# Add an executable called callbhmie
									add_executable(callbhmie
										callbhmie.f
									)
									# Specify that callbhmie links to libbhmie.a
									target_link_libraries(callbhmie
										bhmie 
									)
								</code></pre></div>
							</div>
					</section>
					<section>
						<img class="plain" data-src="images/add_library.png">
					</section>
				</section>

				<!-- Slide 3 -->
				<section data-transition="none-in none-out">
					<section>
						<h3 style="margin: 0;">A Basic CMake Project</h3>
						<h5 style="margin: 0">bhmie-f/CMakeLists.txt</h5>
						<hr>
						<div class="container">
								<div class="file-tree"> 
									<code><strong>bhmie-f/</strong><br>
										├── bhmie_mod.f90<br>
										├── bhmie_smod.f<br>
										├── callbhmie.f<br>
										├── <strong>CMakeLists.txt</strong><br>
										└── README<br>
									</code>
								</div>
								<div class="inline-wide"><pre><code class="cmake" data-trim data-noescape data-line-numbers="13-15">
									cmake_minimum_required(VERSION 3.5)
									project(bhmie VERSION 1.0.0 LANGUAGES Fortran)
		
		
									# Add a static library called libbhmie.a
									add_library(bhmie STATIC
										bhmie_smod.f
										bhmie_mod.f90
									)
		
		
									# Add an executable called callbhmie
									add_executable(callbhmie
										callbhmie.f
									)
									# Specify that callbhmie links to libbhmie.a
									target_link_libraries(callbhmie
										bhmie 
									)
								</code></pre></div>
							</div>
					</section>
					<section>
						<img class="plain" data-src="images/add_executable.png">
					</section>
				</section>

				<!-- Slide 4 -->
				<section data-transition="none-in none-out">
					<section>
						<h3 style="margin: 0;">A Basic CMake Project</h3>
						<h5 style="margin: 0">bhmie-f/CMakeLists.txt</h5>
						<hr>
						<div class="container">
								<div class="file-tree"> 
									<code><strong>bhmie-f/</strong><br>
										├── bhmie_mod.f90<br>
										├── bhmie_smod.f<br>
										├── callbhmie.f<br>
										├── <strong>CMakeLists.txt</strong><br>
										└── README<br>
									</code>
								</div>
								<div class="inline-wide"><pre><code class="cmake" data-trim data-noescape data-line-numbers="16-19">
									cmake_minimum_required(VERSION 3.5)
									project(bhmie VERSION 1.0.0 LANGUAGES Fortran)
		
		
									# Add a static library called libbhmie.a
									add_library(bhmie STATIC
										bhmie_smod.f
										bhmie_mod.f90
									)
		
		
									# Add an executable called callbhmie
									add_executable(callbhmie
										callbhmie.f
									)
									# Specify that callbhmie links to libbhmie.a
									target_link_libraries(callbhmie
										bhmie 
									)
								</code></pre></div>
							</div>
					</section>
					<section>
						<img class="plain" data-src="images/target_link_libraries-1.png">
					</section>
				</section>

				<!-- Slide 5 -->
				<section data-transition="none-in none-out">
					<section>
						<h3 style="margin: 0;">A Basic CMake Project</h3>
						<h5 style="margin: 0">Questions?</h5>
						<hr>
						<div class="container">
							<div class="file-tree"> 
								<code><strong>bhmie-f/</strong><br>
									├── bhmie_mod.f90<br>
									├── bhmie_smod.f<br>
									├── callbhmie.f<br>
									├── <strong>CMakeLists.txt</strong><br>
									└── README<br>
								</code>
							</div>
							<div class="inline-wide"><pre><code class="cmake" data-trim data-noescape data-line-numbers>
								cmake_minimum_required(VERSION 3.5)
								project(bhmie VERSION 1.0.0 LANGUAGES Fortran)
	
	
								# Add a static library called libbhmie.a
								add_library(bhmie STATIC
									bhmie_smod.f
									bhmie_mod.f90
								)
	
	
								# Add an executable called callbhmie
								add_executable(callbhmie
									callbhmie.f
								)
								# Specify that callbhmie links to libbhmie.a
								target_link_libraries(callbhmie
									bhmie 
								)
							</code></pre></div>
						</div>
					</section>
				</section>

				<!-- Slide 5 -->
				<section data-markdown="target_and_properties.md"
						 data-separator="^\n\n\n"
						 data-separator-vertical="^\n\n"
						 data-separator-notes="^Note:"
					  	 data-charset="iso-8859-15">
				</section>

				<section>
					<h2>A Bigger CMake Project</h2>
				</section>

				<!-- Slide 5 -->
				<section>
						<!-- add_subdirectory and find_package, special variables, then what CMake is good at/not good at ...consistency-->
						<h3 style="margin: 0;">A Bigger CMake Project</h3>
						<h5 style="margin: 0">Overview</h5>
						<hr>
						<div class="container" style="width: 90%">
							<div class="inline-wide" style="text-align: left; margin-right: 100px;">
								
									<ul>
										<li>Example aerosol microphysics library called "amp"</li>
										<li>Builds on the bhmie-f project</li>
										<li><code>amp_*.f90 </code>  are modules with microphysics routines
											<ul><li>These require LAPACK</li></ul>
										</li>
										<li><code>cloud_parcel.f90</code> is a parcel model
											<ul><li>Uses kracken for command line argument parsing</li></ul>
										</li>
									</ul>
							</div>
							<div class="file-tree" style="margin: 0;"> 
								<h3>Directory structure</h3>
								<code>
								amp/<br>
								├── kracken/ ⇒ <a href="https://github.com/mlt/kracken">github.com/mlt/kracken</a><br>
								├── bhmie-f/<br>
								│   ├── bhmie_mod.f90<br>
								│   ├── bhmie_smod.f<br>
								│   ├── callbhmie.f<br>
								│   ├── CMakeLists.txt<br>
								│   └── README<br>
								├── amp_chemistry.f90<br>
								├── amp_dynamics.f90<br>
								├── amp_optical.f90<br>
								├── amp_utils.f90<br>
								├── CMakeLists.txt<br>
								└── cloud_parcel.f90<br>
								</code>
							</div>
						</div>
				</section>

				<!-- Slide 5 -->
				<section>
					<!-- add_subdirectory and find_package, special variables, then what CMake is good at/not good at ...consistency-->
					<h3 style="margin: 0;">A Bigger CMake Project</h3>
					<h5 style="margin: 0">Conceptually we need to...</h5>
					<hr>
						<div class="container" style="width: 90%">
							<div class="inline-wide" style="text-align: left; margin-right: 100px;">
								<ol>
									<li class="fragment fade-in-then-semi-out">Build <code>libamp.a</code>
										<ul>
											<li>Source files: <code>amp_*.f90</code></li>
											<li>Build <code>libbhmie.a</code></li>
											<li>Put <code>libbhmie.a</code> into <code>libamp.a</code></li>
											<li>Find LAPACK installation</li>
											<li>Include module directories for bhmie and LAPACK</li>
										</ul>
									</li>
									<li class="fragment fade-in">Build <code>cloud_parcel.f90</code>
										<ul>
											
											<li>Build <code>libkracken.a</code></li>
											<li>Link <code>libamp.a</code> and <code>libkracken.a</code> and their dependencies
												<ul><li>Link "libblas.so" (since LAPACK is used by amp)</li></ul>
											</li>
											<li>Include kracken's module directories for amp and kracken</li>
										</ul>
									</li>
								</ol>
							</div>
							<div class="file-tree" style="margin: 0;"> 
								<h3>Directory structure</h3>
								<code>
								amp/<br>
								├── kracken/ ⇒ <a href="https://github.com/mlt/kracken">github.com/mlt/kracken</a><br>
								├── bhmie-f/<br>
								│   ├── bhmie_mod.f90<br>
								│   ├── bhmie_smod.f<br>
								│   ├── callbhmie.f<br>
								│   ├── CMakeLists.txt<br>
								│   └── README<br>
								├── amp_chemistry.f90<br>
								├── amp_dynamics.f90<br>
								├── amp_optical.f90<br>
								├── amp_utils.f90<br>
								├── CMakeLists.txt<br>
								└── cloud_parcel.f90<br>
								</code>
							</div>
						</div>
				</section>

				<!-- Slide 2 -->
				<section data-transition="none-in none-out">
					<section>
						<h3 style="margin: 0;">A Bigger CMake Project</h3>
						<h5 style="margin: 0">amp/CMakeLists</h5>
						<hr>
						<div style="position: relative;">
							<div>
								<pre><code class="cmake" data-trim data-noescape data-line-numbers>
									cmake_minimum_required(VERSION 3.5)
									project(amp VERSION 0.0.0 LANGUAGES Fortran)
									set(CMAKE_POLICY_DEFAULT_CMP0048 NEW)
									
									set(CMAKE_Fortran_MODULE_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}/modules)
									
									add_subdirectory(bhmie-f)
									add_subdirectory(kracken)

									find_package(LAPACK REQUIRED)
									
									add_library(amp
										amp_chemistry.f90 amp_dynamics.f90 amp_optical.f90 amp_utils.f90
									)
									target_link_libraries(amp
										PUBLIC bhmie ${LAPACK_LIBRARIES}
									)
									target_include_directories(amp
										PUBLIC ${CMAKE_Fortran_MODULE_DIRECTORY}
									)

									add_executable(cloud_parcel cloud_parcel.f90)
									target_link_libraries(cloud_parcel amp kracken)
								</code></pre>
							</div>
							<div class="file-tree"> 
								<small style="position: absolute; top: 0; right: 0;"><code>
								<strong>amp/</strong><br>
								├── kracken/<br>
								├── bhmie-f/<br>
								├── amp_chemistry.f90<br>
								├── amp_dynamics.f90<br>
								├── amp_optical.f90<br>
								├── amp_utils.f90<br>
								├── <strong>CMakeLists.txt</strong><br>
								└── cloud_parcel.f90<br>
								</code></small>
							</div>
						</div>
					</section>
				</section>

				<!-- Slide 2 -->
				<section data-transition="none-in none-out">
					<section>
						<h3 style="margin: 0;">A Bigger CMake Project</h3>
						<h5 style="margin: 0">amp/CMakeLists</h5>
						<hr>
						<div style="position: relative;">
							<div>
								<pre><code class="cmake" data-trim data-noescape data-line-numbers="3,5">
									cmake_minimum_required(VERSION 3.5)
									project(amp VERSION 0.0.0 LANGUAGES Fortran)
									set(CMAKE_POLICY_DEFAULT_CMP0048 NEW)
									
									set(CMAKE_Fortran_MODULE_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}/modules)
									
									add_subdirectory(bhmie-f)
									add_subdirectory(kracken)

									find_package(LAPACK REQUIRED)
									
									add_library(amp
										amp_chemistry.f90 amp_dynamics.f90 amp_optical.f90 amp_utils.f90
									)
									target_link_libraries(amp
										PUBLIC bhmie ${LAPACK_LIBRARIES}
									)
									target_include_directories(amp
										PUBLIC ${CMAKE_Fortran_MODULE_DIRECTORY}
									)

									add_executable(cloud_parcel cloud_parcel.f90)
									target_link_libraries(cloud_parcel amp kracken)
								</code></pre>
							</div>
							<div class="file-tree"> 
								<small style="position: absolute; top: 0; right: 0;"><code>
								<strong>amp/</strong><br>
								├── kracken/<br>
								├── bhmie-f/<br>
								├── amp_chemistry.f90<br>
								├── amp_dynamics.f90<br>
								├── amp_optical.f90<br>
								├── amp_utils.f90<br>
								├── <strong>CMakeLists.txt</strong><br>
								└── cloud_parcel.f90<br>
								</code></small>
							</div>
						</div>
					</section>
					<section>
						<img class="plain" data-src="images/set.png">
					</section>
				</section>

				<!-- Slide 2 -->
				<section data-transition="none-in none-out">
					<section>
						<h3 style="margin: 0;">A Bigger CMake Project</h3>
						<h5 style="margin: 0">amp/CMakeLists</h5>
						<hr>
						<div style="position: relative;">
							<div>
								<pre><code class="cmake" data-trim data-noescape data-line-numbers="1-3">
									cmake_minimum_required(VERSION 3.5)
									project(amp VERSION 0.0.0 LANGUAGES Fortran)
									set(CMAKE_POLICY_DEFAULT_CMP0048 NEW)
									
									set(CMAKE_Fortran_MODULE_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}/modules)
									
									add_subdirectory(bhmie-f)
									add_subdirectory(kracken)

									find_package(LAPACK REQUIRED)
									
									add_library(amp
										amp_chemistry.f90 amp_dynamics.f90 amp_optical.f90 amp_utils.f90
									)
									target_link_libraries(amp
										PUBLIC bhmie ${LAPACK_LIBRARIES}
									)
									target_include_directories(amp
										PUBLIC ${CMAKE_Fortran_MODULE_DIRECTORY}
									)

									add_executable(cloud_parcel cloud_parcel.f90)
									target_link_libraries(cloud_parcel amp kracken)
								</code></pre>
							</div>
							<div class="file-tree"> 
								<small style="position: absolute; top: 0; right: 0;"><code>
								<strong>amp/</strong><br>
								├── kracken/<br>
								├── bhmie-f/<br>
								├── amp_chemistry.f90<br>
								├── amp_dynamics.f90<br>
								├── amp_optical.f90<br>
								├── amp_utils.f90<br>
								├── <strong>CMakeLists.txt</strong><br>
								└── cloud_parcel.f90<br>
								</code></small>
							</div>
						</div>
					</section>
					<section>
						<img class="plain" data-src="images/cmp0048.png">
					</section>
				</section>

				<!-- Slide 2 -->
				<section data-transition="none-in none-out">
					<section>
						<h3 style="margin: 0;">A Bigger CMake Project</h3>
						<h5 style="margin: 0">amp/CMakeLists</h5>
						<hr>
						<div style="position: relative;">
							<div>
								<pre><code class="cmake" data-trim data-noescape data-line-numbers="5">
									cmake_minimum_required(VERSION 3.5)
									project(amp VERSION 0.0.0 LANGUAGES Fortran)
									set(CMAKE_POLICY_DEFAULT_CMP0048 NEW)
									
									set(CMAKE_Fortran_MODULE_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}/modules)
									
									add_subdirectory(bhmie-f)
									add_subdirectory(kracken)

									find_package(LAPACK REQUIRED)
									
									add_library(amp
										amp_chemistry.f90 amp_dynamics.f90 amp_optical.f90 amp_utils.f90
									)
									target_link_libraries(amp
										PUBLIC bhmie ${LAPACK_LIBRARIES}
									)
									target_include_directories(amp
										PUBLIC ${CMAKE_Fortran_MODULE_DIRECTORY}
									)

									add_executable(cloud_parcel cloud_parcel.f90)
									target_link_libraries(cloud_parcel amp kracken)
								</code></pre>
							</div>
							<div class="file-tree"> 
								<small style="position: absolute; top: 0; right: 0;"><code>
								<strong>amp/</strong><br>
								├── kracken/<br>
								├── bhmie-f/<br>
								├── amp_chemistry.f90<br>
								├── amp_dynamics.f90<br>
								├── amp_optical.f90<br>
								├── amp_utils.f90<br>
								├── <strong>CMakeLists.txt</strong><br>
								└── cloud_parcel.f90<br>
								</code></small>
							</div>
						</div>
					</section>
					<section>
						<img class="plain" data-src="images/fortran_module_directory.png">
					</section>
					<section>
							<img class="plain" data-src="images/current_binary_dir.png">
						</section>
				</section>

				<!-- Slide 2 -->
				<section data-transition="none-in none-out">
					<section>
						<h3 style="margin: 0;">A Bigger CMake Project</h3>
						<h5 style="margin: 0">amp/CMakeLists</h5>
						<hr>
						<div style="position: relative;">
							<div>
								<pre><code class="cmake" data-trim data-noescape data-line-numbers="7-8">
									cmake_minimum_required(VERSION 3.5)
									project(amp VERSION 0.0.0 LANGUAGES Fortran)
									set(CMAKE_POLICY_DEFAULT_CMP0048 NEW)
									
									set(CMAKE_Fortran_MODULE_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}/modules)
									
									add_subdirectory(bhmie-f)
									add_subdirectory(kracken)

									find_package(LAPACK REQUIRED)
									
									add_library(amp
										amp_chemistry.f90 amp_dynamics.f90 amp_optical.f90 amp_utils.f90
									)
									target_link_libraries(amp
										PUBLIC bhmie ${LAPACK_LIBRARIES}
									)
									target_include_directories(amp
										PUBLIC ${CMAKE_Fortran_MODULE_DIRECTORY}
									)

									add_executable(cloud_parcel cloud_parcel.f90)
									target_link_libraries(cloud_parcel amp kracken)
								</code></pre>
							</div>
							<div class="file-tree"> 
								<small style="position: absolute; top: 0; right: 0;"><code>
								<strong>amp/</strong><br>
								├── kracken/<br>
								├── bhmie-f/<br>
								├── amp_chemistry.f90<br>
								├── amp_dynamics.f90<br>
								├── amp_optical.f90<br>
								├── amp_utils.f90<br>
								├── <strong>CMakeLists.txt</strong><br>
								└── cloud_parcel.f90<br>
								</code></small>
							</div>
						</div>
					</section>
					<section>
						<img class="plain" data-src="images/add_subdirectory.png">
					</section>
				</section>

				<!-- Slide 2 -->
				<section data-transition="none-in none-out">
					<section>
						<h3 style="margin: 0;">A Bigger CMake Project</h3>
						<h5 style="margin: 0">amp/CMakeLists</h5>
						<hr>
						<div style="position: relative;">
							<div>
								<pre><code class="cmake" data-trim data-noescape data-line-numbers="10">
									cmake_minimum_required(VERSION 3.5)
									project(amp VERSION 0.0.0 LANGUAGES Fortran)
									set(CMAKE_POLICY_DEFAULT_CMP0048 NEW)
									
									set(CMAKE_Fortran_MODULE_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}/modules)
									
									add_subdirectory(bhmie-f)
									add_subdirectory(kracken)

									find_package(LAPACK REQUIRED)
									
									add_library(amp
										amp_chemistry.f90 amp_dynamics.f90 amp_optical.f90 amp_utils.f90
									)
									target_link_libraries(amp
										PUBLIC bhmie ${LAPACK_LIBRARIES}
									)
									target_include_directories(amp
										PUBLIC ${CMAKE_Fortran_MODULE_DIRECTORY}
									)

									add_executable(cloud_parcel cloud_parcel.f90)
									target_link_libraries(cloud_parcel amp kracken)
								</code></pre>
							</div>
							<div class="file-tree"> 
								<small style="position: absolute; top: 0; right: 0;"><code>
								<strong>amp/</strong><br>
								├── kracken/<br>
								├── bhmie-f/<br>
								├── amp_chemistry.f90<br>
								├── amp_dynamics.f90<br>
								├── amp_optical.f90<br>
								├── amp_utils.f90<br>
								├── <strong>CMakeLists.txt</strong><br>
								└── cloud_parcel.f90<br>
								</code></small>
							</div>
						</div>
					</section>
					<section>
						<img class="plain" data-src="images/find_package.png">
					</section>
					<section>
						<img class="plain" data-src="images/find_lapack.png" style="max-height: 500px;">
					</section>
				</section>

				<!-- Slide 2 -->
				<section data-transition="none-in none-out">
					<section>
						<h3 style="margin: 0;">A Bigger CMake Project</h3>
						<h5 style="margin: 0">amp/CMakeLists</h5>
						<hr>
						<div style="position: relative;">
							<div>
								<pre><code class="cmake" data-trim data-noescape data-line-numbers="12-20">
									cmake_minimum_required(VERSION 3.5)
									project(amp VERSION 0.0.0 LANGUAGES Fortran)
									set(CMAKE_POLICY_DEFAULT_CMP0048 NEW)
									
									set(CMAKE_Fortran_MODULE_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}/modules)
									
									add_subdirectory(bhmie-f)
									add_subdirectory(kracken)

									find_package(LAPACK REQUIRED)
									
									add_library(amp
										amp_chemistry.f90 amp_dynamics.f90 amp_optical.f90 amp_utils.f90
									)
									target_link_libraries(amp
										PUBLIC bhmie ${LAPACK_LIBRARIES}
									)
									target_include_directories(amp
										PUBLIC ${CMAKE_Fortran_MODULE_DIRECTORY}
									)

									add_executable(cloud_parcel cloud_parcel.f90)
									target_link_libraries(cloud_parcel amp kracken)
								</code></pre>
							</div>
							<div class="file-tree"> 
								<small style="position: absolute; top: 0; right: 0;"><code>
								<strong>amp/</strong><br>
								├── kracken/<br>
								├── bhmie-f/<br>
								├── amp_chemistry.f90<br>
								├── amp_dynamics.f90<br>
								├── amp_optical.f90<br>
								├── amp_utils.f90<br>
								├── <strong>CMakeLists.txt</strong><br>
								└── cloud_parcel.f90<br>
								</code></small>
							</div>
						</div>
					</section>
					<section>
						<img class="plain" data-src="images/add_library.png">
					</section>
					<section>
						<img class="plain" data-src="images/target_link_libraries-2.png">
					</section>
					<section>
						<img class="plain" data-src="images/target_include_directories.png">
					</section>
				</section>

				<!-- Slide 2 -->
				<section data-transition="none-in none-out">
					<section>
						<h3 style="margin: 0;">A Bigger CMake Project</h3>
						<h5 style="margin: 0">amp/CMakeLists</h5>
						<hr>
						<div style="position: relative;">
							<div>
								<pre><code class="cmake" data-trim data-noescape data-line-numbers="22-23">
									cmake_minimum_required(VERSION 3.5)
									project(amp VERSION 0.0.0 LANGUAGES Fortran)
									set(CMAKE_POLICY_DEFAULT_CMP0048 NEW)
									
									set(CMAKE_Fortran_MODULE_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}/modules)
									
									add_subdirectory(bhmie-f)
									add_subdirectory(kracken)

									find_package(LAPACK REQUIRED)
									
									add_library(amp
										amp_chemistry.f90 amp_dynamics.f90 amp_optical.f90 amp_utils.f90
									)
									target_link_libraries(amp
										PUBLIC bhmie ${LAPACK_LIBRARIES}
									)
									target_include_directories(amp
										PUBLIC ${CMAKE_Fortran_MODULE_DIRECTORY}
									)

									add_executable(cloud_parcel cloud_parcel.f90)
									target_link_libraries(cloud_parcel amp kracken)
								</code></pre>
							</div>
							<div class="file-tree"> 
								<small style="position: absolute; top: 0; right: 0;"><code>
								<strong>amp/</strong><br>
								├── kracken/<br>
								├── bhmie-f/<br>
								├── amp_chemistry.f90<br>
								├── amp_dynamics.f90<br>
								├── amp_optical.f90<br>
								├── amp_utils.f90<br>
								├── <strong>CMakeLists.txt</strong><br>
								└── cloud_parcel.f90<br>
								</code></small>
							</div>
						</div>
					</section>
					<section>
						<img class="plain" data-src="images/add_executable.png">
					</section>
					<section>
						<img class="plain" data-src="images/target_link_libraries-2.png">
					</section>
				</section>

				<section data-transition="none-in none-out">
					<h3 style="margin: 0;">A Bigger CMake Project</h3>
					<h5 style="margin: 0">Questions?</h5>
					<hr>
					<div style="position: relative;">
						<div>
							<pre><code class="cmake" data-trim data-noescape data-line-numbers>
								cmake_minimum_required(VERSION 3.5)
								project(amp VERSION 0.0.0 LANGUAGES Fortran)
								set(CMAKE_POLICY_DEFAULT_CMP0048 NEW)
								
								set(CMAKE_Fortran_MODULE_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}/modules)
								
								add_subdirectory(bhmie-f)
								add_subdirectory(kracken)

								find_package(LAPACK REQUIRED)
								
								add_library(amp
									amp_chemistry.f90 amp_dynamics.f90 amp_optical.f90 amp_utils.f90
								)
								target_link_libraries(amp
									PUBLIC bhmie ${LAPACK_LIBRARIES}
								)
								target_include_directories(amp
									PUBLIC ${CMAKE_Fortran_MODULE_DIRECTORY}
								)

								add_executable(cloud_parcel cloud_parcel.f90)
								target_link_libraries(cloud_parcel amp kracken)
							</code></pre>
						</div>
						<div class="file-tree"> 
							<small style="position: absolute; top: 0; right: 0;"><code>
							<strong>amp/</strong><br>
							├── kracken/<br>
							├── bhmie-f/<br>
							├── amp_chemistry.f90<br>
							├── amp_dynamics.f90<br>
							├── amp_optical.f90<br>
							├── amp_utils.f90<br>
							├── <strong>CMakeLists.txt</strong><br>
							└── cloud_parcel.f90<br>
							</code></small>
						</div>
					</div>
				</section>

				<section data-markdown="gets_you.md"
						 data-separator="^\n\n\n"
						 data-separator-vertical="^\n\n"
						 data-separator-notes="^Note:"
					  	 data-charset="iso-8859-15">
				</section>
				<section>
					<div style="text-align: left;">
						<h3 style="margin: 0;">Some good references</h3>
						<hr style="margin-bottom: 30px;">
						<ul>
							<li><a href="https://pabloariasal.github.io/2018/02/19/its-time-to-do-cmake-right/">It's Time To Do CMake Right</a>, by Pablo Arias</li>
							<li><a href="https://www.youtube.com/watch?v=rLopVhns4Zs&feature=youtu.be">Effective CMake</a>, by Daniel Pfeifer</li>
							<li><a href="https://cliutils.gitlab.io/modern-cmake/">Modern CMake</a>, by Henry Schreiner and others</li>
							<li>The <a href="https://cmake.org/cmake/help/latest/index.html">Official CMake Documentation</a></li>
						</ul>
					</div>
				</section>	
				<section>
					<h2>Questions?</h2>
				</section>	
			</div>
		</div>

		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
				]
			});
		</script>
	</body>
</html>
